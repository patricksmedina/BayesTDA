//
//  main.cpp
//  test_wc
//
//  Created by Patrick Medina on 6/5/17.
//  Copyright Â© 2017 Patrick Medina. All rights reserved.
//

#include <iostream>
#include <vector>
#include <cmath>

#include "bayestda.h"

using namespace std;

int main()
{
    int numScales;
    int numCovariates = 1;
    int numSamples = 50;
    int numWavelets = 4;
    bool groupScaling = false;
    
    // check that the number of wavelets is a power of 4.  stop execution otherwise
    // TODO: Transfer this idea to Python / Cython when done.
    if (numWavelets % 4 == 0)
    {
        numScales = (int) log(numWavelets / 4);
    }
    else
    {
        cout << "[ERROR] The number of wavelets in each domain of the persistence diagram must be a power of 2." << endl;
        return 1;
    }
    
    /* TEST */
    vector < vector <float> > waveletCoefficients(numSamples, vector <float>(2 * numWavelets, 0.0));
    vector <int> use(2 * numWavelets, 1);
    vector< vector <float> > covariateMatrix(numSamples, vector <float>(numCovariates, 0.0));
    
    float tempWave[50][8] ={{8.64506614e+00, 1.29681309e+01, 1.22650259e+01, 1.14394899e+01
        ,1.16999580e-01,-2.34002953e-01,-3.24954801e-01,-1.30393046e-01},
        {1.20502375e+01, 4.51119249e+00, 4.86657009e+00, 3.80391724e+00
            , -2.72992074e-01, 4.98534829e-01, 5.01930025e-01, 5.88421445e-01},
        {1.29537539e+01, 2.24392094e+00, 6.58434121e+00, 1.15154976e+01
            , -1.33264494e-01, 9.93733873e-01, 2.58861308e-01,-1.53929065e-01},
        {4.29147724e+00, 1.63088501e+00, 1.30865742e+01, 6.19115501e+00
            ,4.56606782e-01, 7.73137460e-01,-1.74003293e-01, 4.22459812e-01},
        {3.44580424e+00, 1.01018600e+01, 1.35000033e+01, 1.92031614e+01
            ,6.19157613e-01, 5.39970632e-02,-1.95351308e-01,-1.13118549e+00},
        {3.90905687e+00, 1.05519866e+01, 6.79426379e+00,-1.41960490e+01
            ,6.64276037e-01, 5.34081601e-03, 2.09784678e-01, 2.31470539e+00},
        { -1.07875188e+01, 1.24300093e+01, 6.25393139e+00, 1.85027693e+01
            ,2.12958500e+00,-4.04772139e-01, 3.92213331e-01,-8.09930980e-01},
        {1.51467774e+01, 4.60182095e+00, 1.20826791e+01, 1.04616734e+01
            , -4.35610045e-01, 4.95960139e-01,-2.52237090e-01, 7.59566319e-02},
        {1.21437355e+00, 3.63627363e+00, 1.78946773e+01,-1.61524066e+00
            ,8.29415792e-01, 4.92985177e-01,-8.06149759e-01, 1.19818423e+00},
        {4.96000232e+00, 1.21771480e+01, 2.53208857e+01, 1.68854218e+01
            ,5.26765855e-01,-2.11266513e-01,-1.77221708e+00,-6.45783827e-01},
        { -1.25410992e+00, 2.12988195e+00, 3.15903194e+00, 1.45521788e+01
            ,1.06527721e+00, 6.73772920e-01, 8.25144114e-01,-5.02476029e-01},
        { -2.98869218e+00, 2.69961151e+00, 1.81503937e+01, 6.14598683e+00
            ,1.31468668e+00, 8.32708441e-01,-7.19861558e-01, 4.26967865e-01},
        {4.17318760e+00, 2.33979238e+01,-3.35462640e+00,-3.07901347e+00
            ,5.71639451e-01,-1.32109751e+00, 1.40608866e+00, 1.20526066e+00},
        {7.19291916e+00, 1.09494339e+01, 2.98329421e+01, 1.55321770e+01
            ,1.73060363e-01,-1.04054429e-01,-1.86430632e+00,-4.40893113e-01},
        {1.40594435e+01,-2.80222196e+00, 1.41471580e+01, 7.07604768e-01
            , -4.05659897e-01, 1.18815553e+00,-4.67864905e-01, 8.91988912e-01},
        {7.02029305e+00, 1.09051185e+01, 6.71413982e+00, 2.23603855e+01
            ,2.33592772e-01,-1.37973904e-02, 4.68023622e-01,-1.16632408e+00},
        {2.94643425e+01, 2.27982190e+01, 2.51248926e+01, 1.67671443e+01
            , -1.89938807e+00,-1.27992071e+00,-1.41780387e+00,-8.40723600e-01},
        {2.03851616e+01, 3.53402662e+01, 1.40488715e+01, 2.80977554e+01
            , -9.98688464e-01,-2.39624923e+00,-4.79495853e-01,-1.65947797e+00},
        {1.90483826e+01, 1.98120367e+01, 1.41947099e+01,-1.09502668e+01
            , -9.61954532e-01,-8.40942438e-01,-3.34370750e-01, 2.11477736e+00},
        {3.66843454e+00, 6.64382735e+00, 1.83374205e+01, 2.62606356e+01
            ,6.91257502e-01, 3.48653411e-01,-8.43570667e-01,-1.51273938e+00},
        {2.91587174e+01, 1.64734347e+01,-1.46001473e+01, 1.77857132e+01
            , -1.89998691e+00,-5.54485706e-01, 2.35454445e+00,-6.98828380e-01},
        {5.92418579e+00,-8.01934464e+00, 1.26915972e+01, 1.58909979e+01
            ,4.08110530e-01, 1.70135642e+00,-3.69480691e-01,-7.38848306e-01},
        {1.21080241e+01, 1.62046807e+01, 1.75248327e+01, 1.12719560e+01
            , -7.64339713e-02,-6.89483893e-01,-7.79415292e-01, 5.46221158e-02},
        {8.20112070e+00, 1.77405334e+01,-2.50260170e+00, 1.52812582e+01
            ,3.41164502e-01,-7.06563697e-01, 1.33727610e+00,-5.41268545e-01},
        {3.58878607e+01, 7.45520221e+00, 1.19534045e+00, 7.82862972e+00
            , -2.55419462e+00, 2.59398184e-01, 8.50944078e-01, 1.49203328e-01},
        {1.15870842e+01,-1.52936273e+01,-6.81461893e+00,-2.05235404e+01
            , -1.10307396e+00, 1.47472773e+00, 7.49801295e-01, 2.03291205e+00},
        { -1.68446651e+00, 1.51200828e+01, 2.23375648e+00, 1.81608454e+01
            ,2.14561814e-01,-1.44903985e+00,-1.23087966e-01,-1.65218862e+00},
        { -5.78276788e+00,-4.75355958e+00,-9.74872236e-01, 2.00506210e+01
            ,5.59703374e-01, 4.96429817e-01, 2.66324413e-01,-1.92651308e+00},
        { -4.00151443e+00,-6.93937666e+00,-2.90613984e+01,-1.36411419e+00
            ,4.27370508e-01, 6.06575656e-01, 3.02817578e+00, 5.63087335e-02},
        {1.27283438e+01, 1.98974474e+01,-6.38144723e+00,-2.17421055e+01
            , -1.28983339e+00,-1.97198039e+00, 7.37944123e-01, 2.08206233e+00},
        { -3.45768307e+00, 6.84728946e-01, 7.91841446e+00, 4.01054030e+00
            ,3.64821037e-01,-8.17120081e-02,-9.06018918e-01,-4.61136123e-01},
        {1.29070779e+01,-1.80788814e+01, 1.29939480e+01, 2.93871022e+00
            , -1.22750313e+00, 1.73567250e+00,-1.46481665e+00,-3.10564039e-01},
        {1.06174256e+01,-3.34086384e+00, 1.02525543e+01,-6.41711472e+00
            , -1.05668312e+00, 2.70779234e-01,-1.09074369e+00, 6.98704045e-01},
        { -1.66129235e+01,-5.37212863e+00, 2.77963921e+00,-1.72395690e+01
            ,1.66189277e+00, 4.84039336e-01,-2.93714482e-01, 1.69850427e+00},
        {4.26385984e+00, 5.66049379e+00,-8.79573061e+00,-4.93668514e+00
            , -2.17382144e-01,-5.40067912e-01, 9.39511855e-01, 5.32440545e-01},
        { -2.35697343e+01, 5.81542712e+00, 7.04495914e+00, 6.88307221e-01
            ,2.29086649e+00,-4.15727607e-01,-7.28999427e-01,-1.18078815e-01},
        {7.93368868e+00, 2.53665499e-01,-8.52382759e+00, 1.48029410e+01
            , -8.30679264e-01,-3.11013047e-02, 1.01572818e+00,-1.54777814e+00},
        { -5.48889640e+00,-1.11090009e+01, 2.30731206e+01, 5.07596659e-01
            ,8.04079817e-01, 1.04794039e+00,-2.37625949e+00, 6.86579432e-02},
        {1.18910055e+01,-8.04093357e+00,-1.19195610e+01, 1.06800754e+01
            , -1.11220123e+00, 9.86775987e-01, 1.07334407e+00,-9.44106992e-01},
        { -6.49913882e+00,-4.58806840e+00, 7.50883777e+00,-7.91405039e+00
            ,5.43012816e-01, 3.94624674e-01,-7.61760460e-01, 8.62145151e-01},
        { -2.31273410e+01, 1.49580920e+01, 5.87563033e+00,-4.35475602e-01
            ,2.43731217e+00,-1.45188140e+00,-4.32033893e-01, 9.44449930e-02},
        {2.72879482e+00,-9.49228080e+00,-1.45877921e+01, 1.49655701e+00
            , -1.71476474e-01, 8.87707726e-01, 1.32254632e+00,-1.21083387e-01},
        { -9.79581789e+00, 2.51276643e+00,-1.55573326e+00, 1.11860256e+01
            ,1.03621597e+00,-3.30187963e-01, 1.69828313e-01,-1.29369104e+00},
        {5.96261695e+00,-7.37011502e+00,-3.00759936e-01, 8.97931604e+00
            , -6.60949391e-01, 9.37649122e-01,-2.07406967e-02,-8.77798920e-01},
        {7.15332339e+00,-8.99969316e+00, 4.89485533e+00,-1.46450504e+00
            , -5.76997974e-01, 9.76813179e-01,-5.60294780e-01, 2.24512166e-01},
        {9.06718683e+00,-8.23762605e+00, 1.89919886e+00,-5.80457559e-01
            , -8.71647332e-01, 8.37642629e-01,-1.61579250e-01, 1.56190273e-01},
        { -1.28072534e+01, 5.50503038e+00,-6.76388248e+00,-6.65017021e+00
            ,1.19802030e+00,-4.97259670e-01, 7.69615697e-01, 6.76418565e-01},
        {2.05292306e+01, 1.72016675e+01, 9.65369150e-02,-1.62697890e+00
            , -1.83920348e+00,-1.69058933e+00, 9.65207537e-03, 1.20646025e-01},
        {3.01696972e+01,-1.41513994e+01,-4.81808762e-01, 2.37447056e+01
            , -3.08944329e+00, 1.45817324e+00,-4.33650538e-02,-2.39771242e+00},
        { -9.05109987e+00, 8.40350940e+00,-9.79117982e+00, 1.42244838e+01
            ,9.34769440e-01,-1.06814969e+00, 1.21318723e+00,-1.55213878e+00}};
    
//    {{5.93117282e+01, 5.97847017e+01, 6.36228969e+01, 5.20377252e+01
//        ,2.65957334e-02, 6.86599921e-02,-2.11211238e-01, 8.08598726e-01},
//        {4.91253465e+01, 6.67502656e+01, 6.48548807e+01, 5.92146608e+01
//            ,1.18442246e+00,-5.90823118e-01,-2.74073064e-01, 4.69268319e-03},
//        {5.02486059e+01, 7.95636819e+01, 6.75987172e+01, 5.42169808e+01
//            ,9.26541058e-01,-2.01153557e+00,-7.77422279e-01, 6.46225336e-01},
//        {6.34963154e+01, 5.78615937e+01, 5.67682442e+01, 4.33651162e+01
//            , -3.86049204e-01, 1.95921418e-01, 1.35436257e-01, 1.75481170e+00},
//        {5.92613621e+01, 7.73255174e+01, 7.00715017e+01, 5.00543335e+01
//            ,1.80835968e-01,-1.79243761e+00,-1.06940888e+00, 9.70605063e-01},
//        {5.30754855e+01, 5.39845791e+01, 5.75458663e+01, 4.83091854e+01
//            ,5.93292654e-01, 5.41658056e-01, 2.96454027e-01, 1.02966169e+00},
//        {7.64401938e+01, 4.93223112e+01, 5.89415171e+01, 6.18415072e+01
//            , -1.52650586e+00, 1.02896946e+00, 2.03350698e-01,-1.76765083e-01},
//        {5.56003594e+01, 6.52035685e+01, 4.64909697e+01, 7.75790245e+01
//            ,5.81540084e-01,-6.28525464e-01, 1.38776055e+00,-1.69059440e+00},
//        {7.39733709e+01, 5.86086830e+01, 6.52882049e+01, 5.84896266e+01
//            , -1.54178138e+00, 2.92807252e-01,-4.85951292e-01,-4.63256950e-02},
//        {6.02716985e+01, 5.47551109e+01, 6.42135404e+01, 4.85895359e+01
//            ,1.91171786e-01, 5.92383769e-01,-3.69254045e-01, 1.17843218e+00},
//        {6.42129553e+01, 5.88871518e+01, 5.05572989e+01, 6.58980409e+01
//            , -4.35240281e-01, 2.43409521e-01, 8.87783485e-01,-5.72242720e-01},
//        {6.89653367e+01, 7.68739488e+01, 4.75046646e+01, 5.39828129e+01
//            , -1.01008651e+00,-1.75036196e+00, 1.36585090e+00, 4.93701620e-01},
//        {7.05307817e+01, 4.61827230e+01, 6.81437390e+01, 6.71610341e+01
//            , -1.18701736e+00, 1.32178267e+00,-7.81404310e-01,-6.80518101e-01},
//        {6.34451544e+01, 8.27989175e+01, 5.82691670e+01, 5.06388866e+01
//            , -3.77600130e-01,-2.41259615e+00, 1.71329047e-01, 9.67581003e-01},
//        {3.18454046e+01, 5.58343263e+01, 4.69285708e+01, 6.14228486e+01
//            ,2.98850067e+00, 5.26714132e-01, 1.32957170e+00,-2.06594925e-01},
//        {5.25385384e+01, 6.00195730e+01, 5.00967514e+01, 6.10018544e+01
//            ,7.47319854e-01, 7.78112018e-03, 9.88378894e-01,-3.74663510e-02},
//        {4.93475430e+01, 5.88882219e+01, 5.76819075e+01, 4.72190535e+01
//            ,1.08818341e+00, 5.52969536e-02, 2.38166388e-01, 1.48464920e+00},
//        {6.54429177e+01, 4.75788904e+01, 7.04575633e+01, 7.61271233e+01
//            , -4.79340052e-01, 1.25123101e+00,-1.03576306e+00,-1.51951657e+00},
//        {4.69080395e+01, 6.11117995e+01, 7.40689610e+01, 6.50486169e+01
//            ,1.39121622e+00,-1.99197283e-01,-1.62280405e+00,-3.31031158e-01},
//        {6.07446745e+01, 8.73557292e+01, 5.39608117e+01, 6.82546344e+01
//            , -3.47721324e-01,-2.79662089e+00, 6.54903302e-01,-8.44162354e-01},
//        {6.38724357e+01, 6.09327688e+01, 8.07190760e+01, 6.28449324e+01
//            , -4.79385845e-01,-9.04031642e-02,-2.10165134e+00,-1.37615547e-01},
//        {6.89630092e+01, 4.14623532e+01, 5.68058832e+01, 4.89697327e+01
//            , -8.83565223e-01, 1.82834626e+00, 3.19412468e-01, 1.22130585e+00},
//        {7.18236955e+01, 5.40531216e+01, 6.31068492e+01, 6.17310743e+01
//            , -1.15196549e+00, 6.94629327e-01,-2.08208396e-01,-2.85726208e-02},
//        {5.36469963e+01, 6.63114905e+01, 6.74153464e+01, 7.27123301e+01
//            ,6.40813773e-01,-6.59126416e-01,-7.61241170e-01,-1.31535720e+00},
//        {4.36234644e+01, 6.59538591e+01, 5.44811274e+01, 6.60065049e+01
//            ,1.68227112e+00,-5.62624229e-01, 3.85780839e-01,-6.12186455e-01},
//        { -1.91708630e+00, 2.09565107e+01, 8.66004677e+00, 2.09742955e+01
//            ,1.22313121e+00,-1.02964640e+00, 1.86380893e-01,-1.12759197e+00},
//        {1.06144944e+01,-4.77988151e+00, 1.20588266e+01, 1.64752457e+01
//            , -8.76383425e-02, 1.48869563e+00,-1.33196961e-01,-5.44411968e-01},
//        {1.26042274e+01, 1.25859352e+01, 1.79444952e+01, 8.98624499e+00
//            , -1.90785421e-01,-1.26838067e-01,-8.30112435e-01,-1.37740987e-02},
//        {1.35323349e+01, 1.31884204e+01, 1.01601886e+00, 2.30138284e+01
//            , -4.32884565e-01,-3.33655120e-01, 7.75277029e-01,-1.23569763e+00},
//        {1.26782482e+01,-1.17869317e+01, 1.37173180e+01, 3.70940385e+00
//            , -3.41827331e-01, 2.11333981e+00,-4.11382987e-01, 6.55749260e-01},
//        {1.63856186e+00, 1.39759562e+01, 1.02861694e+01, 2.08205119e+01
//            ,6.43525984e-01,-4.86589031e-01,-2.36252177e-02,-9.49368302e-01},
//        {1.31289010e+01, 1.95906601e+01, 1.51333842e+01, 4.73768683e+00
//            , -2.75045965e-01,-8.75788127e-01,-6.00333417e-01, 4.67788190e-01},
//        {1.50977208e+01, 1.87793015e+01,-9.56316061e+00, 1.12817340e+01
//            , -6.22818829e-01,-8.47942344e-01, 1.92910135e+00,-1.70028961e-01},
//        {1.94883967e+01, 1.90036262e+01, 7.30181496e+00, 1.91922445e+01
//            , -8.19738141e-01,-9.23767826e-01, 4.06898113e-01,-8.27102601e-01},
//        { -3.48934345e+00, 7.97491112e+00, 2.15725218e+01, 4.71971448e+00
//            ,1.31540399e+00, 2.17657910e-01,-1.21766670e+00, 4.84974521e-01},
//        {1.54922364e+00, 1.56172185e+01, 1.12421466e+01,-4.73591102e+00
//            ,8.36746879e-01,-6.24469251e-01,-1.42741738e-02, 1.51412656e+00},
//        {1.71134148e+01, 8.34724084e+00,-1.76454888e+00, 1.83766843e+01
//            , -7.51442553e-01, 6.85401036e-02, 9.92899843e-01,-7.50795807e-01},
//        {4.58073553e+00, 1.05895083e+01, 8.17706426e+00, 1.16518977e+01
//            ,4.88867666e-01,-2.88949448e-02, 1.06518900e-01,-1.97981586e-01},
//        {1.87576599e+01, 1.82728720e+01, 2.96200453e+01, 1.88295670e+01
//            , -9.23267360e-01,-9.11238822e-01,-2.03462350e+00,-1.03924663e+00},
//        {1.57171741e+00, 1.49556468e+00,-5.59235197e+00, 1.43686683e+01
//            ,9.31986865e-01, 8.56330525e-01, 1.44437926e+00,-3.05370353e-01},
//        { -6.70753662e+00, 6.93673553e+00,-5.19595333e+00, 2.80092716e+01
//            ,1.75276870e+00, 4.22357003e-01, 1.61905297e+00,-1.76798166e+00},
//        {8.01143595e+00, 1.24884544e+01, 3.15190238e+01, 1.16953469e+01
//            ,3.10120480e-01,-2.02337849e-01,-2.11868904e+00,-1.76920740e-01},
//        {2.18468032e+00, 8.28118727e+00, 2.23903114e+01, 1.61326426e+01
//            ,9.95020897e-01, 2.97501930e-01,-1.17335904e+00,-6.44842472e-01},
//        {2.42705605e+00, 2.74841198e+01, 7.06665947e+00, 1.51791443e+01
//            ,8.88026836e-01,-1.63148692e+00, 3.04399642e-01,-2.86655810e-01},
//        {2.17293099e+01, 7.61205025e+00, 1.06069443e+01, 1.26187457e+01
//            , -1.25878182e+00, 1.20607087e-01,-1.03537552e-01,-4.14070606e-01},
//        {2.37083985e+01, 1.04338288e+01, 1.01948446e+01, 2.35313702e+00
//            , -1.43275408e+00, 1.00969087e-03,-7.67078661e-02, 6.85229554e-01},
//        {3.85255846e+00, 5.40781530e+00, 4.03412757e-02, 2.70713121e+01
//            ,6.64389921e-01, 4.51486073e-01, 1.09755812e+00,-1.93215341e+00},
//        {2.43805416e+01, 2.29081878e+01, 1.77481154e+01, 3.36739723e+01
//            , -1.32522295e+00,-1.39381799e+00,-7.92118739e-01,-2.34403069e+00},
//        { -4.01029752e+00, 2.70321417e+01, 2.38947084e+01, 3.76638620e+01
//            ,1.43448196e+00,-1.69185819e+00,-1.58899561e+00,-2.79215600e+00},
//        {7.56476024e+00,-1.23325530e+01, 3.40934658e+00, 1.08769881e+01
//            ,2.21204405e-01, 2.01535999e+00, 7.53501904e-01, 3.03137948e-03}};

    float tempCov[50][1] = {{1},
        {1},
        {1},
        {1},
        {1},
        {1},
        {1},
        {1},
        {1},
        {1},
        {1},
        {1},
        {1},
        {1},
        {1},
        {1},
        {1},
        {1},
        {1},
        {1},
        {1},
        {1},
        {1},
        {1},
        {1},
        {0},
        {0},
        {0},
        {0},
        {0},
        {0},
        {0},
        {0},
        {0},
        {0},
        {0},
        {0},
        {0},
        {0},
        {0},
        {0},
        {0},
        {0},
        {0},
        {0},
        {0},
        {0},
        {0},
        {0},
        {0}};
    
    for (int i = 0; i < numSamples; i++)
    {
        for (int k = 0; k < numCovariates; k++)
        {
            covariateMatrix[i][k] = tempCov[i][k];
        }
        
        for (int j = 0; j < 2 * numWavelets; j++)
        {
            waveletCoefficients[i][j] = tempWave[i][j];
        }
    }
    // END TEST
    
    btda::bayesRegressionDM br(numScales, numWavelets, numCovariates, numSamples, waveletCoefficients, covariateMatrix, use, groupScaling);
    br.performBayesianAnalysis();
    
    vector< vector<double> > * posteriorProbs = br.getPosteriorProbabilities();
    for (int cov = 0; cov < numCovariates; cov++)
    {
        for (int row = 0; row < 4; row++)
        {
            cout << (*posteriorProbs)[row][cov] << "\t";
        }
        cout << endl;
    }
    
    cout << endl << endl;
    
    vector<double> * piEstimates = br.getPiEstimates();
    
    for (int i = 0; i < 4; i++)
    {
        cout << (*piEstimates)[i] << endl;
    }
    
    return 0;
}
